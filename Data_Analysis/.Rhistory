require(robCompositions)
require(tibble)
require(dplyr)
require(vegan)
require(ggplot2)
require(ggsci)
require(mice)
setwd('G:/Dan_Lab/codes/CAZyme/CAZYme_Analysis/Data_Analysis/')
#clr of cazyme data
cazyme <- read.table('./data/Cazyme_total2.txt',sep='\t',header = T,row.names = 1)
#cazyme <- read.table('./data/Cazyme_total_try.txt',sep='\t',header = T,row.names = 1)
map <- read.table("./maps/SampleID_map.txt", sep = "\t", header = T, comment = "")
cazyme_filter <- as.data.frame(t(cazyme))
cazyme_filter <- rownames_to_column(cazyme_filter,var = 'X.SampleID')
cazyme_filter <- merge(cazyme_filter,map[c('X.SampleID','UserName','StudyDayNo')],by = 'X.SampleID')
cazyme_filter <- cazyme_filter[,-grep('Other',colnames(cazyme_filter))]
colnames(cazyme_filter) <- gsub(".*;L4_",'',colnames(cazyme_filter))
#cazyme_filter <- cazyme_filter[,colnames(cazyme_filter)!='X.SampleID']
cazyme_list <- list()
for(i in unique(cazyme_filter$UserName)){
print(i)
temp_cazyme <- cazyme_filter[cazyme_filter$UserName==i,!colnames(cazyme_filter)%in%c('X.SampleID','UserName','StudyDayNo')]
#temp_cazyme <- sweep(temp_cazyme,1,rowSums(temp_cazyme),'/')
temp_cazyme <- sweep(temp_cazyme,1,rowSums(temp_cazyme),'/')
temp <- as.data.frame(apply(temp_cazyme, 2, function(x){
iqr <- IQR(x)
q_25 <-quantile(x)['25%']
q_75 <- quantile(x)['75%']
x[x==0] <- NA
x[x>=q_75+1.5*iqr||x<=q_25-1.5*iqr] <- NA
x
}))
temp2 <- sapply(temp,function(x){
sum(is.na(x))
})
temp <- temp[,temp2<nrow(temp_cazyme)*0.25]
temp$StudyDayNo <- cazyme_filter[cazyme_filter$UserName==i,'StudyDayNo']
imputed_Data <- mice(temp, m=3, maxit = 30, method = 'pmm', seed = 500)
temp_imp <- complete(imputed_Data,2)
cazyme_list[[i]] <- temp_imp
}
warnings()
View(cazyme_list)
View(cazyme_list[["MCTs01"]])
temp3 <- sapply(temp_imp,function(x){
sum(is.na(x))
})
for(i in unique(cazyme_filter$UserName)){
print(i)
temp_cazyme <- cazyme_filter[cazyme_filter$UserName==i,!colnames(cazyme_filter)%in%c('X.SampleID','UserName','StudyDayNo')]
#temp_cazyme <- sweep(temp_cazyme,1,rowSums(temp_cazyme),'/')
temp_cazyme <- sweep(temp_cazyme,1,rowSums(temp_cazyme),'/')
temp <- as.data.frame(apply(temp_cazyme, 2, function(x){
iqr <- IQR(x)
q_25 <-quantile(x)['25%']
q_75 <- quantile(x)['75%']
x[x==0] <- NA
x[x>=q_75+1.5*iqr||x<=q_25-1.5*iqr] <- NA
x
}))
temp2 <- sapply(temp,function(x){
sum(is.na(x))
})
temp <- temp[,temp2<nrow(temp_cazyme)*0.25]
temp$StudyDayNo <- cazyme_filter[cazyme_filter$UserName==i,'StudyDayNo']
imputed_Data <- mice(temp, m=3, maxit = 30, method = 'pmm', seed = 500)
temp_imp <- complete(imputed_Data,2)
temp3 <- sapply(temp_imp,function(x){
sum(is.na(x))
})
temp_imp <- temp_imp[,temp3>0]
cazyme_list[[i]] <- temp_imp
}
for(i in unique(cazyme_filter$UserName)){
print(i)
temp_cazyme <- cazyme_filter[cazyme_filter$UserName==i,!colnames(cazyme_filter)%in%c('X.SampleID','UserName','StudyDayNo')]
#temp_cazyme <- sweep(temp_cazyme,1,rowSums(temp_cazyme),'/')
temp_cazyme <- sweep(temp_cazyme,1,rowSums(temp_cazyme),'/')
temp <- as.data.frame(apply(temp_cazyme, 2, function(x){
iqr <- IQR(x)
q_25 <-quantile(x)['25%']
q_75 <- quantile(x)['75%']
x[x==0] <- NA
x[x>=q_75+1.5*iqr||x<=q_25-1.5*iqr] <- NA
x
}))
temp2 <- sapply(temp,function(x){
sum(is.na(x))
})
temp <- temp[,temp2<nrow(temp_cazyme)*0.25]
temp$StudyDayNo <- cazyme_filter[cazyme_filter$UserName==i,'StudyDayNo']
imputed_Data <- mice(temp, m=3, maxit = 30, method = 'pmm', seed = 500)
temp_imp <- complete(imputed_Data,2)
temp3 <- sapply(temp_imp,function(x){
sum(is.na(x))
})
temp_imp <- temp_imp[,temp3==0]
cazyme_list[[i]] <- temp_imp
}
View(cazyme_list[["MCTs01"]])
cazyme_list_clr <- lapply(cazyme_list, function(x){
cenLR(x)$x
})
View(cazyme_list_clr)
View(cazyme_list_clr[["MCTs25"]])
save(cazyme_list,'./data/cazyme_list.RData')
save(cazyme_list,file = './data/cazyme_list.RData')
save(cazyme_list_clr,file = './data/cazy_list_clr.RData')
#temp_cazyme <- cazyme_c[cazyme_c$UserName==i,!colnames(cazyme_c)%in%c('X.SampleID','UserName')]
temp_cazyme <- cazyme_list_clr[i]
View(temp_cazyme)
#temp_cazyme <- cazyme_c[cazyme_c$UserName==i,!colnames(cazyme_c)%in%c('X.SampleID','UserName')]
temp_cazyme <- cazyme_list_clr[[i]]
View(temp_cazyme)
cazyme_food_list <- list()
for(i in unique(food_c$UserName)){
print(i)
coef_v <- c()
fdr_v <- c()
food_v <- c()
cazyme_v <- c()
p_v <- c()
id <- c()
temp_food <- food_c[food_c$UserName==i,!colnames(food_c)%in%c('X.SampleID','UserName')]
#temp_cazyme <- cazyme_c[cazyme_c$UserName==i,!colnames(cazyme_c)%in%c('X.SampleID','UserName')]
temp_cazyme <- cazyme_list_clr[[i]]
temp_food <- temp_food[,colSums(temp_food)!=0]
temp_cazyme_pre <- temp_cazyme
temp_cazyme <- sweep(temp_cazyme,1,rowSums(temp_cazyme),'/')
temp_cazyme_pre[temp_cazyme_pre>=1] <- 1
temp_cazyme_pre <- temp_cazyme_pre[,colSums(temp_cazyme_pre)>0.75*nrow(temp_cazyme_pre)]
temp_cazyme <- temp_cazyme[,colnames(temp_cazyme)%in%colnames(temp_cazyme_pre)]
temp_cor_r <- corr.test(temp_food,temp_cazyme,adjust = 'fdr',method = 'spearman')$r
temp_cor_p <- corr.test(temp_food,temp_cazyme,adjust = 'none',method = 'spearman')$p
temp_cor_fdr <- corr.test(temp_food,temp_cazyme,adjust = 'fdr',method = 'spearman')$p
for(a in 1:nrow(temp_cor_p)){
#print(a)
for (b in 1:ncol(temp_cor_p)){
if(!is.na(temp_cor_p[a,b])){
coef_v <- c(coef_v,temp_cor_r[a,b])
fdr_v <- c(fdr_v,temp_cor_fdr[a,b])
food_v <- c(food_v,colnames(temp_food)[a])
cazyme_v <- c(cazyme_v,colnames(temp_cazyme)[b])
p_v <- c(p_v,temp_cor_p[a,b])
id <- c(id,i)
}
}
}
#fdr_v <- p.adjust(p_v,method = 'fdr')
temp_cor_df <- data.frame(food=food_v,cazyme=cazyme_v,coef=coef_v,id=id,fdr_p=fdr_v,p=p_v)
cazyme_food_list[[i]] <- temp_cor_df
}
setwd('G:/Dan_Lab/codes/CAZyme/CAZYme_Analysis/Data_Analysis/')
food <- read.table('./data/masterdecaydiet.txt',header = T)
food$taxonomy <- as.character(food$taxonomy)
split <- strsplit(food$taxonomy,";")
foodStrings <- sapply(split,function(x) paste(x[1:2],collapse=";"))
for (i in 1:7) taxaStrings = gsub("(;[A-z]__$)?(;NA$)?","",foodStrings,perl=T) # clean tips
food_L2 <- rowsum(food[-ncol(food)],foodStrings)
rownames(food_L2) <- gsub(".*;L2_",'',rownames(food_L2))
#rownames(food_L2) = sapply(strsplit(food$taxonomy,";"),function(x) paste(x[1:2],collapse=";"));
cazyme <- read.table('./data/Cazyme_total2.txt',sep='\t',header = T,row.names = 1)
cazyme <- cazyme[-grep('Other',rownames(cazyme)),]
rownames(cazyme) <- gsub(".*;L4_",'',rownames(cazyme))
map <- read.table("./maps/SampleID_map.txt", sep = "\t", header = T, comment = "")
# identify soylent samples
soylent <- map[map$UserName %in% c("MCTs11", "MCTs12"),]
soylent <- as.character(soylent$X.SampleID)
cazyme <- cazyme[,!colnames(cazyme)%in%soylent]
food_L2 <- food_L2[,!colnames(food_L2)%in%soylent]
samples <- intersect(colnames(cazyme),colnames(food_L2))
cazyme <- cazyme[samples]
food_L2 <- food_L2[samples]
cazyme_c <- as.data.frame(t(cazyme))
cazyme_c <- rownames_to_column(cazyme_c,var = 'X.SampleID')
cazyme_c <- merge(cazyme_c,map[c('X.SampleID','UserName')],by='X.SampleID')
food_c <- as.data.frame(t(food_L2))
food_c <- rownames_to_column(food_c,var='X.SampleID')
food_c <- merge(food_c,map[c('X.SampleID','UserName')],by='X.SampleID')
cazyme_food_list <- list()
for(i in unique(food_c$UserName)){
print(i)
coef_v <- c()
fdr_v <- c()
food_v <- c()
cazyme_v <- c()
p_v <- c()
id <- c()
temp_food <- food_c[food_c$UserName==i,!colnames(food_c)%in%c('X.SampleID','UserName')]
#temp_cazyme <- cazyme_c[cazyme_c$UserName==i,!colnames(cazyme_c)%in%c('X.SampleID','UserName')]
temp_cazyme <- cazyme_list_clr[[i]]
temp_food <- temp_food[,colSums(temp_food)!=0]
temp_cazyme_pre <- temp_cazyme
temp_cazyme <- sweep(temp_cazyme,1,rowSums(temp_cazyme),'/')
temp_cazyme_pre[temp_cazyme_pre>=1] <- 1
temp_cazyme_pre <- temp_cazyme_pre[,colSums(temp_cazyme_pre)>0.75*nrow(temp_cazyme_pre)]
temp_cazyme <- temp_cazyme[,colnames(temp_cazyme)%in%colnames(temp_cazyme_pre)]
temp_cor_r <- corr.test(temp_food,temp_cazyme,adjust = 'fdr',method = 'spearman')$r
temp_cor_p <- corr.test(temp_food,temp_cazyme,adjust = 'none',method = 'spearman')$p
temp_cor_fdr <- corr.test(temp_food,temp_cazyme,adjust = 'fdr',method = 'spearman')$p
for(a in 1:nrow(temp_cor_p)){
#print(a)
for (b in 1:ncol(temp_cor_p)){
if(!is.na(temp_cor_p[a,b])){
coef_v <- c(coef_v,temp_cor_r[a,b])
fdr_v <- c(fdr_v,temp_cor_fdr[a,b])
food_v <- c(food_v,colnames(temp_food)[a])
cazyme_v <- c(cazyme_v,colnames(temp_cazyme)[b])
p_v <- c(p_v,temp_cor_p[a,b])
id <- c(id,i)
}
}
}
#fdr_v <- p.adjust(p_v,method = 'fdr')
temp_cor_df <- data.frame(food=food_v,cazyme=cazyme_v,coef=coef_v,id=id,fdr_p=fdr_v,p=p_v)
cazyme_food_list[[i]] <- temp_cor_df
}
require(robCompositions)
require(tibble)
require(psych)
require(reshape2)
setwd('G:/Dan_Lab/codes/CAZyme/CAZYme_Analysis/Data_Analysis/')
food <- read.table('./data/masterdecaydiet.txt',header = T)
food$taxonomy <- as.character(food$taxonomy)
split <- strsplit(food$taxonomy,";")
foodStrings <- sapply(split,function(x) paste(x[1:2],collapse=";"))
for (i in 1:7) taxaStrings = gsub("(;[A-z]__$)?(;NA$)?","",foodStrings,perl=T) # clean tips
food_L2 <- rowsum(food[-ncol(food)],foodStrings)
rownames(food_L2) <- gsub(".*;L2_",'',rownames(food_L2))
#rownames(food_L2) = sapply(strsplit(food$taxonomy,";"),function(x) paste(x[1:2],collapse=";"));
cazyme <- read.table('./data/Cazyme_total2.txt',sep='\t',header = T,row.names = 1)
cazyme <- cazyme[-grep('Other',rownames(cazyme)),]
rownames(cazyme) <- gsub(".*;L4_",'',rownames(cazyme))
map <- read.table("./maps/SampleID_map.txt", sep = "\t", header = T, comment = "")
# identify soylent samples
soylent <- map[map$UserName %in% c("MCTs11", "MCTs12"),]
soylent <- as.character(soylent$X.SampleID)
cazyme <- cazyme[,!colnames(cazyme)%in%soylent]
food_L2 <- food_L2[,!colnames(food_L2)%in%soylent]
samples <- intersect(colnames(cazyme),colnames(food_L2))
cazyme <- cazyme[samples]
food_L2 <- food_L2[samples]
cazyme_c <- as.data.frame(t(cazyme))
cazyme_c <- rownames_to_column(cazyme_c,var = 'X.SampleID')
cazyme_c <- merge(cazyme_c,map[c('X.SampleID','UserName')],by='X.SampleID')
food_c <- as.data.frame(t(food_L2))
food_c <- rownames_to_column(food_c,var='X.SampleID')
food_c <- merge(food_c,map[c('X.SampleID','UserName')],by='X.SampleID')
cazyme_food_list <- list()
for(i in unique(food_c$UserName)){
print(i)
coef_v <- c()
fdr_v <- c()
food_v <- c()
cazyme_v <- c()
p_v <- c()
id <- c()
temp_food <- food_c[food_c$UserName==i,!colnames(food_c)%in%c('X.SampleID','UserName')]
#temp_cazyme <- cazyme_c[cazyme_c$UserName==i,!colnames(cazyme_c)%in%c('X.SampleID','UserName')]
temp_cazyme <- cazyme_list_clr[[i]]
temp_food <- temp_food[,colSums(temp_food)!=0]
temp_cazyme_pre <- temp_cazyme
temp_cazyme <- sweep(temp_cazyme,1,rowSums(temp_cazyme),'/')
temp_cazyme_pre[temp_cazyme_pre>=1] <- 1
temp_cazyme_pre <- temp_cazyme_pre[,colSums(temp_cazyme_pre)>0.75*nrow(temp_cazyme_pre)]
temp_cazyme <- temp_cazyme[,colnames(temp_cazyme)%in%colnames(temp_cazyme_pre)]
temp_cor_r <- corr.test(temp_food,temp_cazyme,adjust = 'fdr',method = 'spearman')$r
temp_cor_p <- corr.test(temp_food,temp_cazyme,adjust = 'none',method = 'spearman')$p
temp_cor_fdr <- corr.test(temp_food,temp_cazyme,adjust = 'fdr',method = 'spearman')$p
for(a in 1:nrow(temp_cor_p)){
#print(a)
for (b in 1:ncol(temp_cor_p)){
if(!is.na(temp_cor_p[a,b])){
coef_v <- c(coef_v,temp_cor_r[a,b])
fdr_v <- c(fdr_v,temp_cor_fdr[a,b])
food_v <- c(food_v,colnames(temp_food)[a])
cazyme_v <- c(cazyme_v,colnames(temp_cazyme)[b])
p_v <- c(p_v,temp_cor_p[a,b])
id <- c(id,i)
}
}
}
#fdr_v <- p.adjust(p_v,method = 'fdr')
temp_cor_df <- data.frame(food=food_v,cazyme=cazyme_v,coef=coef_v,id=id,fdr_p=fdr_v,p=p_v)
cazyme_food_list[[i]] <- temp_cor_df
}
View(temp_food)
View(cazyme_list_clr[["MCTs03"]])
