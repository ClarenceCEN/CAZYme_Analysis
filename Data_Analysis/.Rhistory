cazyme_dist <- dist(select(all_cazyme,-UserName,-StudyDayNo,-X.SampleID))
cazymepc <- as.data.frame(pcoa(cazyme_dist)$vectors)
rownames(cazymepc) <- all_cazyme$X.SampleID
cazyme_predict_dat <- list()
for(i in unique(all_cazyme$UserName)){
print(i)
temp_data <- NULL
#temp_sampleid
temp_data$X.SampleID.x <- dat[[i]]$X.SampleID.x
temp_data$X.SampleID.y <- dat[[i]]$X.SampleID.y
interested_X.SampleID <- Reduce(base::intersect,list(v1=temp_data$X.SampleID.y,
v2=temp_data$X.SampleID.x,
v3=all_cazyme$X.SampleID,
v4=rownames(food_L2)))
temp_data$X.SampleID.x <- temp_data$X.SampleID.x[temp_data$X.SampleID.x%in%interested_X.SampleID]
temp_data$X.SampleID.y <- temp_data$X.SampleID.y[temp_data$X.SampleID.y%in%interested_X.SampleID]
temp_cazyme.x <- all_cazyme[all_cazyme$X.SampleID%in%interested_X.SampleID,] %>% select(-UserName,-StudyDayNo,-X.SampleID)
temp_cazyme.y <- all_cazyme[all_cazyme$X.SampleID%in%interested_X.SampleID,] %>% select(-UserName,-StudyDayNo,-X.SampleID)
colnames(temp_cazyme.y) <- paste0(colnames(temp_cazyme.x),'.y')
colnames(temp_cazyme.x) <- paste0(colnames(temp_cazyme.x),'.x')
temp_cazymepc <- cazymepc[rownames(cazymepc)%in%interested_X.SampleID,][1:5]
colnames(temp_cazymepc) <- paste0('cazyme.',colnames(temp_cazymepc))
temp_food <- food_L2[rownames(food_L2)%in%interested_X.SampleID,]
temp_data <- cbind(temp_data,temp_cazyme.x,temp_cazyme.y,temp_cazymepc,temp_food)
if(nrow(temp_data)==0){
next()
}
cazyme_predict_dat[[i]] <- temp_data
}
for(i in names(cazyme_predict_dat)){
today.cazymes <- paste0(cazyme_to_keep,'.x')
tomorrow.cazymes <- paste0(cazyme_to_keep,'.y')
rf.importance.list <- list()
for(j in seq_along(tomorrow.cazymes)){
today.cazyme <- today.cazymes[j]
tomorrow.cazyme <- tomorrow.cazymes[j]
cazyme.features <- c("cazyme.Axis.1","cazyme.Axis.2", "cazyme.Axis.3", "cazyme.Axis.4", "cazyme.Axis.5")
food.features <- colnames(food_L2)
predictor.feats <- cazyme_predict_dat[[i]][,c(cazyme.features,food.features)]
result.cazyme.tomorrow <- cazyme_predict_dat[[i]][tomorrow.cazyme]
rf.formula <- as.formula(paste0(tomorrow.cazyme,'~',paste(cazyme.features,collapse = '+'),'+',
paste(food.features,collapse = '+')))
model <- randomForest(rf.formula,data = cazyme_predict_dat[[i]],importance=TRUE,mtry=5)
rf.importance <- as.data.frame(model$importanceSD)
colnames(rf.importance) <- paste0(i,gsub('.y','',tomorrow.cazyme))
rf.importance.list[[gsub('.y','',tomorrow.cazyme)]] <- rf.importance
}
rf.importance.sub <- do.call('cbind',rf.importance.list)
}
warnings()
cazyme_predict_dat <- list()
for(i in unique(all_cazyme$UserName)){
print(i)
temp_data <- NULL
#temp_sampleid
temp_data$X.SampleID.x <- dat[[i]]$X.SampleID.x
temp_data$X.SampleID.y <- dat[[i]]$X.SampleID.y
interested_X.SampleID <- Reduce(base::intersect,list(v1=temp_data$X.SampleID.y,
v2=temp_data$X.SampleID.x,
v3=all_cazyme$X.SampleID,
v4=rownames(food_L2)))
temp_data$X.SampleID.x <- temp_data$X.SampleID.x[temp_data$X.SampleID.x%in%interested_X.SampleID]
temp_data$X.SampleID.y <- temp_data$X.SampleID.y[temp_data$X.SampleID.y%in%interested_X.SampleID]
temp_cazyme.x <- all_cazyme[all_cazyme$X.SampleID%in%interested_X.SampleID,] %>% select(-UserName,-StudyDayNo,-X.SampleID)
temp_cazyme.y <- all_cazyme[all_cazyme$X.SampleID%in%interested_X.SampleID,] %>% select(-UserName,-StudyDayNo,-X.SampleID)
colnames(temp_cazyme.y) <- paste0(colnames(temp_cazyme.x),'.y')
colnames(temp_cazyme.x) <- paste0(colnames(temp_cazyme.x),'.x')
temp_cazymepc <- cazymepc[rownames(cazymepc)%in%interested_X.SampleID,][1:5]
colnames(temp_cazymepc) <- paste0('cazyme.',colnames(temp_cazymepc))
temp_food <- food_L2[rownames(food_L2)%in%interested_X.SampleID,]
temp_data <- cbind(temp_data,temp_cazyme.x,temp_cazyme.y,temp_cazymepc,temp_food)
if(nrow(temp_data)<=5){
next()
}
cazyme_predict_dat[[i]] <- temp_data
}
View(cazyme_predict_dat)
i=1
today.cazymes <- paste0(cazyme_to_keep,'.x')
tomorrow.cazymes <- paste0(cazyme_to_keep,'.y')
rf.importance.list <- list()
today.cazymes
for(j in seq_along(tomorrow.cazymes)){
today.cazyme <- today.cazymes[j]
tomorrow.cazyme <- tomorrow.cazymes[j]
cazyme.features <- c("cazyme.Axis.1","cazyme.Axis.2", "cazyme.Axis.3", "cazyme.Axis.4", "cazyme.Axis.5")
food.features <- colnames(food_L2)
predictor.feats <- cazyme_predict_dat[[i]][,c(cazyme.features,food.features)]
result.cazyme.tomorrow <- cazyme_predict_dat[[i]][tomorrow.cazyme]
rf.formula <- as.formula(paste0(tomorrow.cazyme,'~',paste(cazyme.features,collapse = '+'),'+',
paste(food.features,collapse = '+')))
model <- randomForest(rf.formula,data = cazyme_predict_dat[[i]],importance=TRUE,mtry=5)
rf.importance <- as.data.frame(model$importanceSD)
colnames(rf.importance) <- paste0(i,gsub('.y','',tomorrow.cazyme))
rf.importance.list[[gsub('.y','',tomorrow.cazyme)]] <- rf.importance
}
View(rf.importance.sub)
View(rf.importance.list)
rf.importance.list <- list()
i='MCTs01'
rf.importance.list <- list()
for(j in seq_along(tomorrow.cazymes)){
today.cazyme <- today.cazymes[j]
tomorrow.cazyme <- tomorrow.cazymes[j]
cazyme.features <- c("cazyme.Axis.1","cazyme.Axis.2", "cazyme.Axis.3", "cazyme.Axis.4", "cazyme.Axis.5")
food.features <- colnames(food_L2)
predictor.feats <- cazyme_predict_dat[[i]][,c(cazyme.features,food.features)]
result.cazyme.tomorrow <- cazyme_predict_dat[[i]][tomorrow.cazyme]
rf.formula <- as.formula(paste0(tomorrow.cazyme,'~',paste(cazyme.features,collapse = '+'),'+',
paste(food.features,collapse = '+')))
model <- randomForest(rf.formula,data = cazyme_predict_dat[[i]],importance=TRUE,mtry=5)
rf.importance <- as.data.frame(model$importanceSD)
colnames(rf.importance) <- paste0(i,gsub('.y','',tomorrow.cazyme))
rf.importance.list[[gsub('.y','',tomorrow.cazyme)]] <- rf.importance
}
rf.importance.sub <- do.call('cbind',rf.importance.list)
View(rf.importance.sub)
cazyme_rf_importance <- list()
cazyme_rf_importance <- list()
for(i in names(cazyme_predict_dat)){
today.cazymes <- paste0(cazyme_to_keep,'.x')
tomorrow.cazymes <- paste0(cazyme_to_keep,'.y')
rf.importance.list <- list()
for(j in seq_along(tomorrow.cazymes)){
today.cazyme <- today.cazymes[j]
tomorrow.cazyme <- tomorrow.cazymes[j]
cazyme.features <- c("cazyme.Axis.1","cazyme.Axis.2", "cazyme.Axis.3", "cazyme.Axis.4", "cazyme.Axis.5")
food.features <- colnames(food_L2)
predictor.feats <- cazyme_predict_dat[[i]][,c(cazyme.features,food.features)]
result.cazyme.tomorrow <- cazyme_predict_dat[[i]][tomorrow.cazyme]
rf.formula <- as.formula(paste0(tomorrow.cazyme,'~',paste(cazyme.features,collapse = '+'),'+',
paste(food.features,collapse = '+')))
model <- randomForest(rf.formula,data = cazyme_predict_dat[[i]],importance=TRUE,mtry=5)
rf.importance <- as.data.frame(model$importanceSD)
colnames(rf.importance) <- paste0(i,gsub('.y','',tomorrow.cazyme))
rf.importance.list[[tomorrow.cazyme]] <- rf.importance
}
rf.importance.sub <- do.call('cbind',rf.importance.list)
cazyme_rf_importance[[i]] <- rf.importance.sub
}
cazyme_rf_importance <- list()
for(i in names(cazyme_predict_dat)){
print(i)
today.cazymes <- paste0(cazyme_to_keep,'.x')
tomorrow.cazymes <- paste0(cazyme_to_keep,'.y')
rf.importance.list <- list()
for(j in seq_along(tomorrow.cazymes)){
today.cazyme <- today.cazymes[j]
tomorrow.cazyme <- tomorrow.cazymes[j]
cazyme.features <- c("cazyme.Axis.1","cazyme.Axis.2", "cazyme.Axis.3", "cazyme.Axis.4", "cazyme.Axis.5")
food.features <- colnames(food_L2)
predictor.feats <- cazyme_predict_dat[[i]][,c(cazyme.features,food.features)]
result.cazyme.tomorrow <- cazyme_predict_dat[[i]][tomorrow.cazyme]
rf.formula <- as.formula(paste0(tomorrow.cazyme,'~',paste(cazyme.features,collapse = '+'),'+',
paste(food.features,collapse = '+')))
model <- randomForest(rf.formula,data = cazyme_predict_dat[[i]],importance=TRUE,mtry=5)
rf.importance <- as.data.frame(model$importanceSD)
colnames(rf.importance) <- paste0(i,gsub('.y','',tomorrow.cazyme))
rf.importance.list[[tomorrow.cazyme]] <- rf.importance
}
rf.importance.sub <- do.call('cbind',rf.importance.list)
cazyme_rf_importance[[i]] <- rf.importance.sub
}
View(rf.importance)
View(rf.importance.list)
View(cazyme_rf_importance)
cazyme_rf_importance <- list()
for(i in names(cazyme_predict_dat)){
print(i)
today.cazymes <- paste0(cazyme_to_keep,'.x')
tomorrow.cazymes <- paste0(cazyme_to_keep,'.y')
rf.importance.list <- list()
for(j in seq_along(tomorrow.cazymes)){
today.cazyme <- today.cazymes[j]
tomorrow.cazyme <- tomorrow.cazymes[j]
cazyme.features <- c("cazyme.Axis.1","cazyme.Axis.2", "cazyme.Axis.3", "cazyme.Axis.4", "cazyme.Axis.5")
food.features <- colnames(food_L2)
predictor.feats <- cazyme_predict_dat[[i]][,c(cazyme.features,food.features)]
result.cazyme.tomorrow <- cazyme_predict_dat[[i]][tomorrow.cazyme]
rf.formula <- as.formula(paste0(tomorrow.cazyme,'~',paste(cazyme.features,collapse = '+'),'+',
paste(food.features,collapse = '+')))
model <- randomForest(rf.formula,data = cazyme_predict_dat[[i]],importance=TRUE,mtry=5)
rf.importance <- as.data.frame(model$importanceSD)
colnames(rf.importance) <- paste0(gsub('.y','',tomorrow.cazyme))
rf.importance.list[[tomorrow.cazyme]] <- rf.importance
}
rf.importance.sub <- do.call('cbind',rf.importance.list)
cazyme_rf_importance[[i]] <- rf.importance.sub
}
View(cazyme_rf_importance)
cazyme_rf_importance[["MCTs01"]]
View(cazyme_rf_importance[["MCTs01"]])
cazyme_rf_importance <- list()
for(i in names(cazyme_predict_dat)){
print(i)
today.cazymes <- paste0(cazyme_to_keep,'.x')
tomorrow.cazymes <- paste0(cazyme_to_keep,'.y')
rf.importance.list <- list()
for(j in seq_along(tomorrow.cazymes)){
today.cazyme <- today.cazymes[j]
tomorrow.cazyme <- tomorrow.cazymes[j]
cazyme.features <- c("cazyme.Axis.1","cazyme.Axis.2", "cazyme.Axis.3", "cazyme.Axis.4", "cazyme.Axis.5")
food.features <- colnames(food_L2)
predictor.feats <- cazyme_predict_dat[[i]][,c(cazyme.features,food.features)]
result.cazyme.tomorrow <- cazyme_predict_dat[[i]][tomorrow.cazyme]
rf.formula <- as.formula(paste0(tomorrow.cazyme,'~',paste(cazyme.features,collapse = '+'),'+',
paste(food.features,collapse = '+')))
model <- randomForest(rf.formula,data = cazyme_predict_dat[[i]],importance=TRUE,mtry=5)
rf.importance <- as.data.frame(model$importanceSD)
colnames(rf.importance) <- paste0(gsub('.y','',tomorrow.cazyme))
rf.importance.list[[tomorrow.cazyme]] <- rf.importance
}
rf.importance.sub <- do.call('cbind',rf.importance.list)
rf.importance.sub[is.na(rf.importance.sub)] <- 0
cazyme_rf_importance[[i]] <- rf.importance.sub
}
View(cazyme_rf_importance)
View(cazyme_rf_importance[["MCTs01"]])
require(pheatmap)
pheatmap(cazyme_rf_importance$MCTs01)
pheatmap(cazyme_rf_importance$MCTs01,scale = 'row')
View(rf.importance.list)
cazyme_rf_importance <- list()
for(i in names(cazyme_predict_dat)){
print(i)
today.cazymes <- paste0(cazyme_to_keep,'.x')
tomorrow.cazymes <- paste0(cazyme_to_keep,'.y')
rf.importance.list <- list()
for(j in seq_along(tomorrow.cazymes)){
today.cazyme <- today.cazymes[j]
tomorrow.cazyme <- tomorrow.cazymes[j]
cazyme.features <- c("cazyme.Axis.1","cazyme.Axis.2", "cazyme.Axis.3", "cazyme.Axis.4", "cazyme.Axis.5")
food.features <- colnames(food_L2)
predictor.feats <- cazyme_predict_dat[[i]][,c(cazyme.features,food.features)]
result.cazyme.tomorrow <- cazyme_predict_dat[[i]][tomorrow.cazyme]
rf.formula <- as.formula(paste0(tomorrow.cazyme,'~',paste(cazyme.features,collapse = '+'),'+',
paste(food.features,collapse = '+')))
model <- randomForest(rf.formula,data = cazyme_predict_dat[[i]],importance=TRUE,mtry=5)
rf.importance <- as.data.frame(model$importanceSD)
colnames(rf.importance) <- paste0(i,gsub('.y','',tomorrow.cazyme))
rf.importance.list[[tomorrow.cazyme]] <- rf.importance
}
rf.importance.sub <- do.call('cbind',rf.importance.list)
rf.importance.sub[is.na(rf.importance.sub)] <- 0
cazyme_rf_importance[[i]] <- rf.importance.sub
}
View(cazyme_rf_importance)
cazyme_rf_importance.all <- do.call('cbind',cazyme_rf_importance)
View(cazyme_rf_importance.all)
View(cazyme_rf_importance)
cazyme_rf_importance <- list()
for(i in names(cazyme_predict_dat)){
print(i)
today.cazymes <- paste0(cazyme_to_keep,'.x')
tomorrow.cazymes <- paste0(cazyme_to_keep,'.y')
rf.importance.list <- list()
for(j in seq_along(tomorrow.cazymes)){
today.cazyme <- today.cazymes[j]
tomorrow.cazyme <- tomorrow.cazymes[j]
cazyme.features <- c("cazyme.Axis.1","cazyme.Axis.2", "cazyme.Axis.3", "cazyme.Axis.4", "cazyme.Axis.5")
food.features <- colnames(food_L2)
predictor.feats <- cazyme_predict_dat[[i]][,c(cazyme.features,food.features)]
result.cazyme.tomorrow <- cazyme_predict_dat[[i]][tomorrow.cazyme]
rf.formula <- as.formula(paste0(tomorrow.cazyme,'~',paste(cazyme.features,collapse = '+'),'+',
paste(food.features,collapse = '+')))
model <- randomForest(rf.formula,data = cazyme_predict_dat[[i]],importance=TRUE,mtry=5)
rf.importance <- as.data.frame(model$importanceSD)
colnames(rf.importance) <- paste0(gsub('.y','',tomorrow.cazyme))
rf.importance.list[[tomorrow.cazyme]] <- rf.importance
}
rf.importance.sub <- do.call('cbind',rf.importance.list)
rf.importance.sub[is.na(rf.importance.sub)] <- 0
cazyme_rf_importance[[i]] <- rf.importance.sub
}
cazyme_rf_importance.all <- do.call('cbind',cazyme_rf_importance)
View(cazyme_rf_importance.all)
pheatmap(cazyme_rf_importance.all,scale = 'row')
pheatmap(cazyme_rf_importance.all)
cazyme_rf_importance.all <- cazyme_rf_importance.all[rowSums(cazyme_rf_importance.all)!=0]
pheatmap(cazyme_rf_importance.all)
pheatmap(cazyme_rf_importance.all,scale = 'row')
apply(cazyme_rf_importance.all, 1, sd)
sapply(cazyme_rf_importance.all, 1, sd)
sapply(cazyme_rf_importance.all,sd)
sapply(cazyme_rf_importance.all,sd)!=0
cazyme_rf_importance.all <- do.call('cbind',cazyme_rf_importance)
cazyme_rf_importance.all <- cazyme_rf_importance.all[sapply(cazyme_rf_importance.all,sd)!=0]
pheatmap(cazyme_rf_importance.all,scale = 'row')
View(cazyme_rf_importance.all)
apply(cazyme_rf_importance.all,1,sd)!=0
cazyme_rf_importance.all <- cazyme_rf_importance.all[apply(cazyme_rf_importance.all,1,sd)!=0,]
pheatmap(cazyme_rf_importance.all,scale = 'row')
dev.off()
pdf(file = './result/import_try.pdf',width = 50,height = 20)
pheatmap(cazyme_rf_importance.all,scale = 'row')
dev.off()
pdf(file = './result/import_try.pdf',width = 50,height = 5)
pheatmap(cazyme_rf_importance.all,scale = 'row')
dev.off()
View(rf.importance.sub)
rf.importance.sub <- as.data.frame(rowMeans(rf.importance.sub))
View(rf.importance.sub)
cazyme_rf_importance[[i]] <- rf.importance.sub
View(cazyme_rf_importance.all)
View(cazyme_rf_importance)
colnames(rf.importance.sub) <- 'avg.importance'
for(i in names(cazyme_predict_dat)){
print(i)
today.cazymes <- paste0(cazyme_to_keep,'.x')
tomorrow.cazymes <- paste0(cazyme_to_keep,'.y')
rf.importance.list <- list()
for(j in seq_along(tomorrow.cazymes)){
today.cazyme <- today.cazymes[j]
tomorrow.cazyme <- tomorrow.cazymes[j]
cazyme.features <- c("cazyme.Axis.1","cazyme.Axis.2", "cazyme.Axis.3", "cazyme.Axis.4", "cazyme.Axis.5")
food.features <- colnames(food_L2)
predictor.feats <- cazyme_predict_dat[[i]][,c(cazyme.features,food.features)]
result.cazyme.tomorrow <- cazyme_predict_dat[[i]][tomorrow.cazyme]
rf.formula <- as.formula(paste0(tomorrow.cazyme,'~',paste(cazyme.features,collapse = '+'),'+',
paste(food.features,collapse = '+')))
model <- randomForest(rf.formula,data = cazyme_predict_dat[[i]],importance=TRUE,mtry=5)
rf.importance <- as.data.frame(model$importanceSD)
colnames(rf.importance) <- paste0(gsub('.y','',tomorrow.cazyme))
rf.importance.list[[tomorrow.cazyme]] <- rf.importance
}
rf.importance.sub <- do.call('cbind',rf.importance.list)
rf.importance.sub[is.na(rf.importance.sub)] <- 0
rf.importance.sub <- as.data.frame(rowMeans(rf.importance.sub))
colnames(rf.importance.sub) <- 'avg.importance'
cazyme_rf_importance[[i]] <- rf.importance.sub
}
cazyme_rf_importance.all <- do.call('cbind',cazyme_rf_importance)
View(cazyme_rf_importance.all)
View(cazyme_rf_importance)
cazyme_rf_importance.all <- do.call('cbind',cazyme_rf_importance)
View(cazyme_rf_importance.all)
for(i in names(cazyme_predict_dat)){
print(i)
today.cazymes <- paste0(cazyme_to_keep,'.x')
tomorrow.cazymes <- paste0(cazyme_to_keep,'.y')
rf.importance.list <- list()
for(j in seq_along(tomorrow.cazymes)){
today.cazyme <- today.cazymes[j]
tomorrow.cazyme <- tomorrow.cazymes[j]
cazyme.features <- c("cazyme.Axis.1","cazyme.Axis.2", "cazyme.Axis.3", "cazyme.Axis.4", "cazyme.Axis.5")
food.features <- colnames(food_L2)
predictor.feats <- cazyme_predict_dat[[i]][,c(cazyme.features,food.features)]
result.cazyme.tomorrow <- cazyme_predict_dat[[i]][tomorrow.cazyme]
rf.formula <- as.formula(paste0(tomorrow.cazyme,'~',paste(cazyme.features,collapse = '+'),'+',
paste(food.features,collapse = '+')))
model <- randomForest(rf.formula,data = cazyme_predict_dat[[i]],importance=TRUE,mtry=5)
rf.importance <- as.data.frame(model$importanceSD)
colnames(rf.importance) <- paste0(gsub('.y','',tomorrow.cazyme))
rf.importance.list[[tomorrow.cazyme]] <- rf.importance
}
rf.importance.sub <- do.call('cbind',rf.importance.list)
rf.importance.sub[is.na(rf.importance.sub)] <- 0
rf.importance.sub <- as.data.frame(rowMeans(rf.importance.sub))
colnames(rf.importance.sub) <- paste0(i,'.avg.importance')
cazyme_rf_importance[[i]] <- rf.importance.sub
}
cazyme_rf_importance.all <- do.call('cbind',cazyme_rf_importance)
View(cazyme_rf_importance.all)
for(i in names(cazyme_predict_dat)){
print(i)
today.cazymes <- paste0(cazyme_to_keep,'.x')
tomorrow.cazymes <- paste0(cazyme_to_keep,'.y')
rf.importance.list <- list()
for(j in seq_along(tomorrow.cazymes)){
today.cazyme <- today.cazymes[j]
tomorrow.cazyme <- tomorrow.cazymes[j]
cazyme.features <- c("cazyme.Axis.1","cazyme.Axis.2", "cazyme.Axis.3", "cazyme.Axis.4", "cazyme.Axis.5")
food.features <- colnames(food_L2)
predictor.feats <- cazyme_predict_dat[[i]][,c(cazyme.features,food.features)]
result.cazyme.tomorrow <- cazyme_predict_dat[[i]][tomorrow.cazyme]
rf.formula <- as.formula(paste0(tomorrow.cazyme,'~',paste(cazyme.features,collapse = '+'),'+',
paste(food.features,collapse = '+')))
model <- randomForest(rf.formula,data = cazyme_predict_dat[[i]],importance=TRUE,mtry=5)
rf.importance <- as.data.frame(model$importanceSD)
colnames(rf.importance) <- paste0(gsub('.y','',tomorrow.cazyme))
rf.importance.list[[tomorrow.cazyme]] <- rf.importance
}
rf.importance.sub <- do.call('cbind',rf.importance.list)
rf.importance.sub[is.na(rf.importance.sub)] <- 0
rf.importance.sub <- as.data.frame(rowMeans(rf.importance.sub))
#colnames(rf.importance.sub) <- paste0(i,'.avg.importance')
colnames(rf.importance.sub) <- i
cazyme_rf_importance[[i]] <- rf.importance.sub
}
cazyme_rf_importance.all <- do.call('cbind',cazyme_rf_importance)
View(cazyme_rf_importance.all)
cazyme_rf_importance.all <- cazyme_rf_importance.all[apply(cazyme_rf_importance.all,1,sd)!=0,]
pheatmap(cazyme_rf_importance.all,scale = 'row')
pheatmap(cazyme_rf_importance.all,scale = 'row', color=colorRampPalette(c("green","black","red"))(100))
View(cazyme_rf_importance.all)
colnames(cazyme_rf_importance.all) <- gsub('food_','',colnames(cazyme_rf_importance.all))
pdf(file = './result/import_try.pdf',width = 10,height = 5)
pheatmap(cazyme_rf_importance.all,scale = 'row', color=colorRampPalette(c("green","black","red"))(100))
dev.off()
dev.off()
pdf(file = './result/import_try.pdf',width = 10,height = 5)
pheatmap(cazyme_rf_importance.all,scale = 'row', color=colorRampPalette(c("green","black","red"))(100))
dev.off()
pdf(file = './result/import_try.pdf',width = 10,height = 8)
pheatmap(cazyme_rf_importance.all,scale = 'row', color=colorRampPalette(c("green","black","red"))(100))
dev.off()
colnames(cazyme_rf_importance.all) <- gsub('food_','',colnames(cazyme_rf_importance.all))
View(cazyme_rf_importance.all)
gsub('food_','',colnames(cazyme_rf_importance.all))
colnames(cazyme_rf_importance.all) <- gsub('food_','',rownames(cazyme_rf_importance.all))
gsub('food_','',rownames(cazyme_rf_importance.all))
rownames(cazyme_rf_importance.all) <- gsub('food_','',rownames(cazyme_rf_importance.all))
pdf(file = './result/import_try.pdf',width = 10,height = 8)
pheatmap(cazyme_rf_importance.all,scale = 'row', color=colorRampPalette(c("green","black","red"))(100))
dev.off()
pheatmap(cazyme_rf_importance.all,scale = 'row', color=colorRampPalette(c("green","black","red"))(100),
border_color = NA)
pdf(file = './result/import_try.pdf',width = 10,height = 8)
pheatmap(cazyme_rf_importance.all,scale = 'row', color=colorRampPalette(c("green","black","red"))(100),
border_color = NA)
dev.off()
dev.off()
pdf(file = './result/import_try.pdf',width = 10,height = 8)
pheatmap(cazyme_rf_importance.all,scale = 'row', color=colorRampPalette(c("green","black","red"))(100),
border_color = NA)
dev.off()
model
#average for each subject
cazyme_rf_importance <- list()
for(i in names(cazyme_predict_dat)){
print(i)
today.cazymes <- paste0(cazyme_to_keep,'.x')
tomorrow.cazymes <- paste0(cazyme_to_keep,'.y')
rf.importance.list <- list()
for(j in seq_along(tomorrow.cazymes)){
today.cazyme <- today.cazymes[j]
tomorrow.cazyme <- tomorrow.cazymes[j]
cazyme.features <- c("cazyme.Axis.1","cazyme.Axis.2", "cazyme.Axis.3", "cazyme.Axis.4", "cazyme.Axis.5")
food.features <- colnames(food_L2)
predictor.feats <- cazyme_predict_dat[[i]][,c(cazyme.features,food.features)]
result.cazyme.tomorrow <- cazyme_predict_dat[[i]][tomorrow.cazyme]
rf.formula <- as.formula(paste0(tomorrow.cazyme,'~',paste(cazyme.features,collapse = '+'),'+',
paste(food.features,collapse = '+')))
model <- randomForest(rf.formula,data = cazyme_predict_dat[[i]],importance=TRUE)
rf.importance <- as.data.frame(model$importanceSD)
colnames(rf.importance) <- paste0(gsub('.y','',tomorrow.cazyme))
rf.importance.list[[tomorrow.cazyme]] <- rf.importance
}
rf.importance.sub <- do.call('cbind',rf.importance.list)
rf.importance.sub[is.na(rf.importance.sub)] <- 0
rf.importance.sub <- as.data.frame(rowMeans(rf.importance.sub))
#colnames(rf.importance.sub) <- paste0(i,'.avg.importance')
colnames(rf.importance.sub) <- i
cazyme_rf_importance[[i]] <- rf.importance.sub
}
cazyme_rf_importance.all <- do.call('cbind',cazyme_rf_importance)
cazyme_rf_importance.all <- cazyme_rf_importance.all[apply(cazyme_rf_importance.all,1,sd)!=0,]
rownames(cazyme_rf_importance.all) <- gsub('food_','',rownames(cazyme_rf_importance.all))
pdf(file = './result/import_try.pdf',width = 10,height = 8)
pheatmap(cazyme_rf_importance.all,scale = 'row', color=colorRampPalette(c("green","black","red"))(100),
border_color = NA)
dev.off()
rf.importance.list <- list()
for(j in seq_along(tomorrow.cazymes)){
today.cazyme <- today.cazymes[j]
tomorrow.cazyme <- tomorrow.cazymes[j]
cazyme.features <- c("cazyme.Axis.1","cazyme.Axis.2", "cazyme.Axis.3", "cazyme.Axis.4", "cazyme.Axis.5")
food.features <- colnames(food_L2)
predictor.feats <- cazyme_predict_dat[[i]][,c(cazyme.features,food.features)]
result.cazyme.tomorrow <- cazyme_predict_dat[[i]][tomorrow.cazyme]
rf.formula <- as.formula(paste0(tomorrow.cazyme,'~',paste(cazyme.features,collapse = '+'),'+',
paste(food.features,collapse = '+')))
model <- randomForest(rf.formula,data = cazyme_predict_dat[[i]],importance=TRUE,ntree=200)
rf.importance <- as.data.frame(model$importanceSD)
colnames(rf.importance) <- paste0(gsub('.y','',tomorrow.cazyme))
rf.importance.list[[tomorrow.cazyme]] <- rf.importance
}
#average for each subject
cazyme_rf_importance <- list()
for(i in names(cazyme_predict_dat)){
print(i)
today.cazymes <- paste0(cazyme_to_keep,'.x')
tomorrow.cazymes <- paste0(cazyme_to_keep,'.y')
rf.importance.list <- list()
for(j in seq_along(tomorrow.cazymes)){
today.cazyme <- today.cazymes[j]
tomorrow.cazyme <- tomorrow.cazymes[j]
cazyme.features <- c("cazyme.Axis.1","cazyme.Axis.2", "cazyme.Axis.3", "cazyme.Axis.4", "cazyme.Axis.5")
food.features <- colnames(food_L2)
predictor.feats <- cazyme_predict_dat[[i]][,c(cazyme.features,food.features)]
result.cazyme.tomorrow <- cazyme_predict_dat[[i]][tomorrow.cazyme]
rf.formula <- as.formula(paste0(tomorrow.cazyme,'~',paste(cazyme.features,collapse = '+'),'+',
paste(food.features,collapse = '+')))
model <- randomForest(rf.formula,data = cazyme_predict_dat[[i]],importance=TRUE,ntree=200)
rf.importance <- as.data.frame(model$importanceSD)
colnames(rf.importance) <- paste0(gsub('.y','',tomorrow.cazyme))
rf.importance.list[[tomorrow.cazyme]] <- rf.importance
}
rf.importance.sub <- do.call('cbind',rf.importance.list)
rf.importance.sub[is.na(rf.importance.sub)] <- 0
rf.importance.sub <- as.data.frame(rowMeans(rf.importance.sub))
#colnames(rf.importance.sub) <- paste0(i,'.avg.importance')
colnames(rf.importance.sub) <- i
cazyme_rf_importance[[i]] <- rf.importance.sub
}
cazyme_rf_importance.all <- do.call('cbind',cazyme_rf_importance)
cazyme_rf_importance.all <- cazyme_rf_importance.all[apply(cazyme_rf_importance.all,1,sd)!=0,]
rownames(cazyme_rf_importance.all) <- gsub('food_','',rownames(cazyme_rf_importance.all))
pdf(file = './result/import_try.pdf',width = 10,height = 8)
pheatmap(cazyme_rf_importance.all,scale = 'row', color=colorRampPalette(c("green","black","red"))(100),
border_color = NA)
dev.off()
