}
select_cazymes <- c()
select_cazymes <- c()
for(i in cazyme_set){
temp_data = allsigs[allsigs$pairs==i,]
if(length(unique(temp_data$bin))>1){
print(i)
select_cazymes <- c(select_cazymes,i)
}
}
select_cazymes <- c()
for(i in cazyme_set){
temp_data = allsigs[allsigs$pairs==i,]
if(length(unique(temp_data$bin))=1){
print(i)
select_cazymes <- c(select_cazymes,i)
}
}
for(i in cazyme_set){
temp_data = allsigs[allsigs$pairs==i,]
if(length(unique(temp_data$bin))==1){
print(i)
select_cazymes <- c(select_cazymes,i)
}
}
select_cazymes <- c()
for(i in cazyme_set){
temp_data = allsigs[allsigs$pairs==i,]
if(length(unique(temp_data$bin))==1){
print(i)
select_cazymes <- c(select_cazymes,i)
}
}
sigs <- lapply(cazyme_food_list, function(x) subset(x, fdr_p <= 0.05))
allsigs <- do.call("rbind", sigs)
allsigs$cazy_cat <- ifelse(grepl('AA',allsigs$cazyme),'AA',
ifelse(grepl('CBM',allsigs$cazyme),'CBM',
ifelse(grepl('GT',allsigs$cazyme),'GT',
ifelse(grepl('GH',allsigs$cazyme),'GH',
ifelse(grepl('PL',allsigs$cazyme),'PL','CE')))))
allsigs$bin <- ifelse(allsigs$coef < 0, "Negative (+/-)",
ifelse(allsigs$coef > 0, "Positive (+/+ or -/-)", "NA"))
allsigs$bin <- factor(allsigs$bin, levels = c("Positive (+/+ or -/-)", "Negative (+/-)"))
allsigs$pairs <- paste0(allsigs$food,'_',allsigs$cazyme)
cazyme_set <- as.character(unique(allsigs$pairs))
select_cazymes <- c()
for(i in cazyme_set){
temp_data = allsigs[allsigs$pairs==i,]
if(length(unique(temp_data$bin))==1){
print(i)
select_cazymes <- c(select_cazymes,i)
}
}
selected_data <- allsigs[allsigs$pairs%in%select_cazymes,]
selected_food_df <- list()
for(i in unique(selected_data$pairs)){
print(i)
selected_food_df[[i]] <- subset(selected_data,selected_data$pairs==i)
}
food_c$UserName <- as.character(food_c$UserName)
cazyme_c$UserName <- as.character(cazyme_c$UserName)
selected_food <- list()
selected_food <- lapply(selected_food_df,function(x){
food_c[food_c$UserName%in%as.character(x$id),colnames(food_c)%in%c("UserName",as.character(x$food))] %>%
melt(id.vars = 'UserName',variable.name = 'food',value.name = 'weight')
})
selected_cazyme <- list()
selected_cazyme <- lapply(selected_food_df,function(x){
cazyme_c[cazyme_c$UserName%in%as.character(x$id),colnames(cazyme_c)%in%c("UserName",as.character(x$cazyme))] %>%
melt(id.vars = 'UserName',variable.name = 'cazyme',value.name = 'count')
})
selected_cazyme_plot <- do.call("rbind", selected_cazyme)
selected_food_plot <- do.call("rbind", selected_food)
#selected_plot <- merge(selected_food,selected_cazyme,by='UserName',all=F)
selected_plot <- bind_cols(selected_food_plot,selected_cazyme_plot)
selected_plot <- selected_plot[,names(selected_plot)!='UserName1']
selected_plot <- mutate_if(selected_plot,is.factor,as.character)
unique(selected_plot$food)
#Deepyellow_vegetables_GH105
plot7 <- subset(selected_plot,selected_plot$food=='Deepyellow_vegetables')
plot7 <- filter(plot7,plot7$cazyme=='GH105')
g <- ggplot(plot6,aes(x=weight,y=count))+geom_point(aes(fill=UserName),alpha=0.5,size=4,shape=21)+
facet_grid(.~UserName,scales = "free") +theme_classic() +
stat_smooth(method = lm,color="black",size=1,se=FALSE)+
scale_fill_manual(values = UserNameColors) +
ylab('GH51') + xlab("Cereals_not_cooked_or_NS_as_to_cooked")
g <- ggplot(plot7,aes(x=weight,y=count))+geom_point(aes(fill=UserName),alpha=0.5,size=4,shape=21)+
facet_grid(.~UserName,scales = "free") +theme_classic() +
stat_smooth(method = lm,color="black",size=1,se=FALSE)+
scale_fill_manual(values = UserNameColors) +
ylab('GH51') + xlab("Cereals_not_cooked_or_NS_as_to_cooked")
g
select_cazymes <- c()
View(allsigs)
for(i in cazyme_set){
temp_data = allsigs[allsigs$pairs==i,]
if(length(unique(temp_data$bin))==1 && length(unique(temp_data$id)>1)){
print(i)
select_cazymes <- c(select_cazymes,i)
}
}
warnings()
select_cazymes <- c()
for(i in cazyme_set){
temp_data = allsigs[allsigs$pairs==i,]
if(length(unique(temp_data$bin))==1 && length(unique(temp_data$id))>1){
print(i)
select_cazymes <- c(select_cazymes,i)
}
}
sigs <- lapply(cazyme_food_list, function(x) subset(x, fdr_p <= 0.2))
allsigs <- do.call("rbind", sigs)
sigs <- lapply(cazyme_food_list, function(x) subset(x, fdr_p <= 0.2))
allsigs <- do.call("rbind", sigs)
allsigs$cazy_cat <- ifelse(grepl('AA',allsigs$cazyme),'AA',
ifelse(grepl('CBM',allsigs$cazyme),'CBM',
ifelse(grepl('GT',allsigs$cazyme),'GT',
ifelse(grepl('GH',allsigs$cazyme),'GH',
ifelse(grepl('PL',allsigs$cazyme),'PL','CE')))))
allsigs$bin <- ifelse(allsigs$coef < 0, "Negative (+/-)",
ifelse(allsigs$coef > 0, "Positive (+/+ or -/-)", "NA"))
allsigs$bin <- factor(allsigs$bin, levels = c("Positive (+/+ or -/-)", "Negative (+/-)"))
allsigs$pairs <- paste0(allsigs$food,'_',allsigs$cazyme)
cazyme_set <- as.character(unique(allsigs$pairs))
select_cazymes <- c()
for(i in cazyme_set){
temp_data = allsigs[allsigs$pairs==i,]
if(length(unique(temp_data$bin))==1 && length(unique(temp_data$id))>1){
print(i)
select_cazymes <- c(select_cazymes,i)
}
}
selected_data <- allsigs[allsigs$pairs%in%select_cazymes,]
selected_food_df <- list()
for(i in unique(selected_data$pairs)){
print(i)
selected_food_df[[i]] <- subset(selected_data,selected_data$pairs==i)
}
food_c$UserName <- as.character(food_c$UserName)
cazyme_c$UserName <- as.character(cazyme_c$UserName)
selected_food <- list()
selected_food <- lapply(selected_food_df,function(x){
food_c[food_c$UserName%in%as.character(x$id),colnames(food_c)%in%c("UserName",as.character(x$food))] %>%
melt(id.vars = 'UserName',variable.name = 'food',value.name = 'weight')
})
selected_cazyme <- list()
selected_cazyme <- lapply(selected_food_df,function(x){
cazyme_c[cazyme_c$UserName%in%as.character(x$id),colnames(cazyme_c)%in%c("UserName",as.character(x$cazyme))] %>%
melt(id.vars = 'UserName',variable.name = 'cazyme',value.name = 'count')
})
selected_cazyme_plot <- do.call("rbind", selected_cazyme)
selected_food_plot <- do.call("rbind", selected_food)
#selected_plot <- merge(selected_food,selected_cazyme,by='UserName',all=F)
selected_plot <- bind_cols(selected_food_plot,selected_cazyme_plot)
selected_plot <- selected_plot[,names(selected_plot)!='UserName1']
selected_plot <- mutate_if(selected_plot,is.factor,as.character)
unique(selected_plot$food)
#Quick_breads_GH137
plot7 <- subset(selected_plot,selected_plot$food=='Quick_breads')
plot7 <- filter(plot7,plot7$cazyme=='GH137')
g <- ggplot(plot7,aes(x=weight,y=count))+geom_point(aes(fill=UserName),alpha=0.5,size=4,shape=21)+
facet_grid(.~UserName,scales = "free") +theme_classic() +
stat_smooth(method = lm,color="black",size=1,se=FALSE)+
scale_fill_manual(values = UserNameColors) +
ylab('GH51') + xlab("Cereals_not_cooked_or_NS_as_to_cooked")
g
View(selected_plot)
ggsave("./result/linear_plots/L2_food/Quick_breads_GH137.pdf",
width = 5,height = 5)
g <- ggplot(plot7,aes(x=weight,y=count))+geom_point(aes(fill=UserName),alpha=0.5,size=4,shape=21)+
facet_grid(.~UserName,scales = "free") +theme_classic() +
stat_smooth(method = lm,color="black",size=1,se=FALSE)+
scale_fill_manual(values = UserNameColors) +
ylab('GH137') + xlab("Quick_breads")
g
ggsave("./result/linear_plots/L2_food/Quick_breads_GH137.pdf",
width = 5,height = 5)
#Nonalcoholic_beverages_GT51
plot8 <- subset(selected_plot,selected_plot$food=='Nonalcoholic_beverages')
plot8 <- filter(plot8,plot7$cazyme=='GT51')
g <- ggplot(plot8,aes(x=weight,y=count))+geom_point(aes(fill=UserName),alpha=0.5,size=4,shape=21)+
facet_grid(.~UserName,scales = "free") +theme_classic() +
stat_smooth(method = lm,color="black",size=1,se=FALSE)+
scale_fill_manual(values = UserNameColors) +
ylab('GH137') + xlab("Quick_breads")
g
#Nonalcoholic_beverages_GT51
plot8 <- subset(selected_plot,selected_plot$food=='Nonalcoholic_beverages')
plot8 <- filter(plot8,plot8$cazyme=='GT51')
g <- ggplot(plot8,aes(x=weight,y=count))+geom_point(aes(fill=UserName),alpha=0.5,size=4,shape=21)+
facet_grid(.~UserName,scales = "free") +theme_classic() +
stat_smooth(method = lm,color="black",size=1,se=FALSE)+
scale_fill_manual(values = UserNameColors) +
ylab('GH137') + xlab("Quick_breads")
g
#Nonalcoholic_beverages_GT51
plot8 <- subset(selected_plot,selected_plot$food=='Nonalcoholic_beverages')
plot8 <- filter(plot8,plot8$cazyme=='GT51')
g <- ggplot(plot8,aes(x=weight,y=count))+geom_point(aes(fill=UserName),alpha=0.5,size=4,shape=21)+
facet_grid(.~UserName,scales = "free") +theme_classic() +
stat_smooth(method = lm,color="black",size=1,se=FALSE)+
scale_fill_manual(values = UserNameColors) +
ylab('GT51') + xlab("Nonalcoholic_beverages")
g
ggsave("./result/linear_plots/L2_food/Nonalcoholic_beverages_GT51.pdf",
width = 5,height = 5)
food <- read.delim("./data/dhydrt.smry.no.soy.txt")
food <- food[,colnames(food)%in%rownames(map_t)]
View(map_t)
View(food)
map_t <- map_t[rownames(map_t)%in%colnames(food),]
load('./data/cazyme_median_clr.RData')
load("./data/cazymes_to_keep_0801.RData")
cazyme_mean_clr <- cazyme_mean_clr[,colnames(cazyme_mean_clr)%in%cazyme_to_keep]
map <- read.table("./maps/food_map.txt", sep = "\t", header = T, comment = "")
map_t <- aggregate(map[c('Gender','Age','BMI')],list(map$UserName),unique)
rownames(map_t) <- map_t$Group.1;map_t <- map_t[-1]
View(cazyme_mean_clr)
map_t <- map_t[rownames(map_t)%in%colnames(food),]
food <- read.delim("./data/dhydrt.smry.no.soy.txt")
food <- food[,colnames(food)%in%rownames(map_t)]
map_t <- map_t[rownames(map_t)%in%colnames(food),]
cazyme_mean_clr <- cazyme_mean_clr[rownames(cazyme_mean_clr)%in%colnames(food),]
library(vegan);library(ape)
cazyme_dist <- dist(cazyme_mean_clr)
cazyme_pcoa <- pcoa(cazyme_dist)
cazyme_plots <- as.data.frame(cazyme_pcoa$vectors[,1:2])
library(ggplot2)
g <- ggplot(cazyme_plots,aes(x=Axis.1,y=Axis.2))+geom_point(aes(color=rownames(cazyme_plots)))+theme_classic()
g
cazyme_rda <- rda(cazyme_mean_clr~.,map_t)
cazyme_rda_s <- summary(cazyme_rda)
anova.cca(cazyme_rda)
View(cazyme_pcoa)
pc1 <- cazyme_pcoa$values
View(pc1)
pc1 <- cazyme_pcoa$values[1,2];pc2 <- cazyme_pcoa$values[2,2]
g <- ggplot(cazyme_plots,aes(x=Axis.1,y=Axis.2))+geom_point(aes(color=rownames(cazyme_plots)),size=2)+theme_classic()+
xlab(paste("PC1",round(pc1*100),"%"))
g
g <- ggplot(cazyme_plots,aes(x=Axis.1,y=Axis.2))+geom_point(aes(color=rownames(cazyme_plots)),size=2)+theme_classic()+
xlab(paste("PC1",round(pc1*100,2),"%"))
g
g <- ggplot(cazyme_plots,aes(x=Axis.1,y=Axis.2))+geom_point(aes(color=rownames(cazyme_plots)),size=2)+theme_classic()+
xlab(paste("PC1",round(pc1*100,2),"%")) +ylab(paste("PC2",round(pc2*100,2),"%"))
g
source(file = "G:/Dan_Lab/dietstudy_analyses-master/lib/colors/UserNameColors.R")
UserNameColors['MCTs05'] <- '#99ff00'
g <- ggplot(cazyme_plots,aes(x=Axis.1,y=Axis.2))+geom_point(aes(color=rownames(cazyme_plots)),size=2)+theme_classic()+
xlab(paste("PC1",round(pc1*100,2),"%")) +ylab(paste("PC2",round(pc2*100,2),"%")) +
scale_color_manual(values = UserNameColors)
g
g <- ggplot(cazyme_plots,aes(x=Axis.1,y=Axis.2))+geom_point(aes(color=rownames(cazyme_plots)),size=2)+theme_classic()+
xlab(paste("PC1",round(pc1*100,2),"%")) +ylab(paste("PC2",round(pc2*100,2),"%")) +
scale_color_manual(values = UserNameColors) + labs(color='Subject')
g
#rda
cazyme_rda <- rda(cazyme_mean_clr~.,map_t)
cazyme_rda_s <- summary(cazyme_rda)
anova.cca(cazyme_rda)
View(food)
cazyme_food_rda <- rda(cazyme_mean_clr~.,t(food))
cazyme_food_rda <- rda(cazyme_mean_clr~.,as.data.frame(t(food)))
cazyme_food_rda <- summary(cazyme_food_rda)
anova.cca(cazyme_food_rda)
food <- read.delim("./data/dhydrt.smry.no.soy.txt")
food <- food[,colnames(food)%in%rownames(map_t)]
View(food)
food <- as.data.frame(t(food))
View(food)
map_t <- map_t[rownames(map_t)%in%rownames(food),]
cazyme_food_rda <- rda(cazyme_mean_clr~.,food)
cazyme_food_rda <- summary(cazyme_food_rda)
anova.cca(cazyme_food_rda)
cazyme_food_rda <- rda(cazyme_mean_clr~.,food)
View(cazyme_food_rda)
View(food)
step(cazyme_food_rda)
ordistep(cazyme_food_rda)
cazyme_food_rda <- cca(cazyme_mean_clr~.,food)
View(cazyme_mean_clr)
rowSums(cazyme_mean_clr)
cazyme_food_rda <- rda(cazyme_mean_clr~.,food)
View(food)
food <- read.delim("./data/dhydrt.smry.no.soy.txt")
food <- food[,colnames(food)%in%rownames(map_t)]
View(food)
food <- read.delim("./data/dhydrt.smry.no.soy.txt")
food$taxonomy <- as.character(food$taxonomy)
split <- strsplit(food$taxonomy,";")
View(split)
foodStrings <- sapply(split,function(x) paste(x[1:3],collapse=";"))
for (i in 1:7) taxaStrings = gsub("(;[A-z]__$)?(;NA$)?","",foodStrings,perl=T) # clean tips
split[[1]]
food <- read.delim("./data/dhydrt.smry.no.soy.txt",row.names = 1)
food$taxonomy <- as.character(food$taxonomy)
split <- strsplit(food$taxonomy,";")
foodStrings <- sapply(split,function(x) paste(x[1:3],collapse=";"))
for (i in 1:7) taxaStrings = gsub("(;[A-z]__$)?(;NA$)?","",foodStrings,perl=T) # clean tips
food_L3 <- rowsum(food[-ncol(food)],foodStrings)
View(food_L3)
rownames(food_L3) <- gsub(".*;L3_",'',rownames(food_L3))
food <- as.data.frame(t(food))
food <- food[,colnames(food)%in%rownames(map_t)]
food <- read.delim("./data/dhydrt.smry.no.soy.txt",row.names = 1)
food$taxonomy <- as.character(food$taxonomy)
split <- strsplit(food$taxonomy,";")
foodStrings <- sapply(split,function(x) paste(x[1:3],collapse=";"))
for (i in 1:7) taxaStrings = gsub("(;[A-z]__$)?(;NA$)?","",foodStrings,perl=T) # clean tips
food_L3 <- rowsum(food[-ncol(food)],foodStrings)
rownames(food_L3) <- gsub(".*;L3_",'',rownames(food_L3))
food <- as.data.frame(t(food))
food_L3 <- as.data.frame(t(food_L3))
View(food_L3)
cazyme_food_rda <- rda(cazyme_mean_clr~.,food_L3)
ordistep(cazyme_food_rda)
step(cazyme_food_rda)
View(food_L3)
View(cazyme_mean_clr)
cazyme <- read.table('./data/Cazyme_total2.txt',sep='\t',header = T,row.names = 1)
#cazyme <- read.table('./data/Cazyme_total_try.txt',sep='\t',header = T,row.names = 1)
map <- read.table("./maps/SampleID_map.txt", sep = "\t", header = T, comment = "")
cazyme <- as.data.frame(t(sweep(cazyme,2,colSums(cazyme),'/')))
setwd('G:/Dan_Lab/codes/CAZyme/CAZYme_Analysis/Data_Analysis/')
#clr of cazyme data
cazyme <- read.table('./data/Cazyme_total2.txt',sep='\t',header = T,row.names = 1)
#cazyme <- read.table('./data/Cazyme_total_try.txt',sep='\t',header = T,row.names = 1)
map <- read.table("./maps/SampleID_map.txt", sep = "\t", header = T, comment = "")
cazyme_filter <- as.data.frame(t(cazyme))
cazyme_filter <- rownames_to_column(cazyme_filter,var = 'X.SampleID')
cazyme_filter <- merge(cazyme_filter,map[c('X.SampleID','UserName','StudyDayNo')],by = 'X.SampleID')
cazyme_sum <- aggregate(t(cazyme),by=list(cazyme_filter$UserName),FUN=sum)
rownames(cazyme_sum) <- cazyme_sum$Group.1;cazyme_sum <- cazyme_sum[-1]
cazyme_sum_for_fil <- cazyme_sum
cazyme_sum_for_fil[cazyme_sum_for_fil>0] <- 1
cazyme_sum <- cazyme_sum[colSums(cazyme_sum_for_fil)>34*0.25]
cazyme_to_keep <- colnames(cazyme_sum)
cazyme_co_var <- aggregate(t(cazyme[cazyme_to_keep,]),by=list(cazyme_filter$UserName),FUN=function(x){sd(x)/(mean(x))})
rownames(cazyme_co_var) <- cazyme_co_var$Group.1;cazyme_co_var <- cazyme_co_var[-1]
cazyme_co_var[is.na(cazyme_co_var)] <- 0
cazyme_co_var <- cazyme_co_var[,order(colMeans(cazyme_co_var),decreasing = T)]
hist(colMeans(cazyme_co_var))
cazyme_co_var <- cazyme_co_var[,1:100]
cazyme_to_keep <- colnames(cazyme_co_var)
cazyme <- cazyme[cazyme_to_keep,]*1.0
cazyme_trans <- t(cazyme)
cazyme_trans <- cazyme_trans[rowSums(cazyme_trans)!=0,]
cazyme_trans <- sweep(cazyme_trans,1,rowSums(cazyme_trans),'/')
View(cazyme_trans)
cazyme_filter <- rownames_to_column(cazyme_trans,var = 'X.SampleID')
cazyme_filter <- rownames_to_column(cazyme_trans,var = 'X.SampleID')
cazyme_trans <- as.data.frame(sweep(cazyme_trans,1,rowSums(cazyme_trans),'/'))
View(cazyme_trans)
cazyme_trans <- t(cazyme)
cazyme_trans <- cazyme_trans[rowSums(cazyme_trans)!=0,]
cazyme_trans <- as.data.frame(sweep(cazyme_trans,1,rowSums(cazyme_trans),'/'))
cazyme_filter <- rownames_to_column(cazyme_trans,var = 'X.SampleID')
cazyme_filter <- merge(cazyme_filter,map[c('X.SampleID','UserName','StudyDayNo')],by = 'X.SampleID')
cazyme_mean <- aggregate(cazyme_trans,by=list(cazyme_filter$UserName),FUN=mean)
rownames(cazyme_mean) <- cazyme_mean$Group.1;cazyme_mean <- cazyme_mean[-1]
View(cazyme_mean)
cazyme_food_rda <- rda(cazyme_mean~.,food_L3)
cazyme_mean <- cazyme_mean[rownames(cazyme_mean)%in%rownames(food_L3),]
cazyme_food_rda <- rda(cazyme_mean~.,food_L3)
step(cazyme_food_rda)
cazyme_food_rda <- rda(cazyme_mean~.,food_L3)
anova.cca(cazyme_food_rda)
foodStrings <- sapply(split,function(x) paste(x[1:2],collapse=";"))
for (i in 1:7) taxaStrings = gsub("(;[A-z]__$)?(;NA$)?","",foodStrings,perl=T) # clean tips
food_L2 <- rowsum(food[-ncol(food)],foodStrings)
food <- read.delim("./data/dhydrt.smry.no.soy.txt",row.names = 1)
food$taxonomy <- as.character(food$taxonomy)
split <- strsplit(food$taxonomy,";")
foodStrings <- sapply(split,function(x) paste(x[1:2],collapse=";"))
for (i in 1:7) taxaStrings = gsub("(;[A-z]__$)?(;NA$)?","",foodStrings,perl=T) # clean tips
food_L2 <- rowsum(food[-ncol(food)],foodStrings)
rownames(food_L2) <- gsub(".*;L2_",'',rownames(food_L2))
food_L2 <- as.data.frame(t(food_L2))
cazyme_food_rda <- rda(cazyme_mean_clr~.,food_L2)
step(cazyme_food_rda)
cazyme_food_rda <- rda(cazyme_mean~.,food_L2)
step(cazyme_food_rda)
cazyme_food_rda <- summary(cazyme_food_rda)
anova.cca(cazyme_food_rda)
View(food_L2)
View(cazyme_mean)
cazyme_food_rda <- rda(cazyme_mean~.,food_L2)
View(cazyme_mean)
View(food_L2)
food <- read.delim("./data/dhydrt.smry.no.soy.txt",row.names = 1)
food$taxonomy <- as.character(food$taxonomy)
split <- strsplit(food$taxonomy,";")
foodStrings <- sapply(split,function(x) paste(x[1:1],collapse=";"))
for (i in 1:7) taxaStrings = gsub("(;[A-z]__$)?(;NA$)?","",foodStrings,perl=T) # clean tips
food_L1 <- rowsum(food[-ncol(food)],foodStrings)
rownames(food_L1) <- gsub(".*;L1_",'',rownames(food_L1))
food_L1 <- as.data.frame(t(food_L1))
cazyme_food_rda <- rda(cazyme_mean~.,food_L1)
step(cazyme_food_rda)
cazyme_food_rda <- rda(cazyme_mean~.,food_L1)
cazyme_food_rda <- rda(cazyme_mean_clr~.,food_L1)
cazyme_food_rda <- summary(cazyme_food_rda)
anova.cca(cazyme_food_rda)
cazyme_food_rda <- rda(cazyme_mean_clr~.,food_L1)
step(cazyme_food_rda)
cazyme_food_rda <- rda(cazyme_mean_clr~.,food_L1)
cazyme_food_rda <- summary(cazyme_food_rda)
View(cazyme_food_rda)
cazyme_food_rda[["cont"]][["importance"]]
anova.cca(cazyme_food_rda)
anova(cazyme_food_rda)
cazyme_food_rda <- rda(cazyme_mean_clr~.,food_L1)
anova(cazyme_food_rda)
cazyme_food_rda_s <- summary(cazyme_food_rda)
anova(cazyme_food_rda)
food_L1 <- rowmean(food[-ncol(food)],foodStrings)
food <- read.delim("./data/dhydrt.smry.no.soy.txt",row.names = 1)
food$taxonomy <- as.character(food$taxonomy)
View(food)
split <- strsplit(food$taxonomy,";")
foodStrings <- sapply(split,function(x) paste(x[1:1],collapse=";"))
for (i in 1:7) taxaStrings = gsub("(;[A-z]__$)?(;NA$)?","",foodStrings,perl=T) # clean tips
food_L1 <- rowsum(food[-ncol(food)],foodStrings)
rownames(food_L1) <- gsub(".*;L1_",'',rownames(food_L1))
food_L1 <- as.data.frame(t(food_L1))
plot(cazyme_food_rda)
rownames(food_L1) <- gsub("L1_",'',rownames(food_L1))
food_L1 <- as.data.frame(t(food_L1))
food <- read.delim("./data/dhydrt.smry.no.soy.txt",row.names = 1)
food$taxonomy <- as.character(food$taxonomy)
split <- strsplit(food$taxonomy,";")
foodStrings <- sapply(split,function(x) paste(x[1:1],collapse=";"))
for (i in 1:7) taxaStrings = gsub("(;[A-z]__$)?(;NA$)?","",foodStrings,perl=T) # clean tips
food_L1 <- rowsum(food[-ncol(food)],foodStrings)
rownames(food_L1) <- gsub("L1_",'',rownames(food_L1))
food_L1 <- as.data.frame(t(food_L1))
cazyme_food_rda <- rda(cazyme_mean_clr~.,food_L1)
step(cazyme_food_rda)
anova(cazyme_food_rda)
cazyme_food_rda <- rda(cazyme_mean_clr~.,food_L1)
anova(cazyme_food_rda)
step(cazyme_food_rda)
a <- step(cazyme_food_rda)
cca.anova(cazyme_food_rda)
anova.cca(cazyme_food_rda)
anova.cca(a)
cazyme_food_rda <- rda(cazyme_mean_clr~.,food_L1)
#a <- step(cazyme_food_rda)
cazyme_food_rda_s <- summary(cazyme_food_rda)
anova.cca(cazyme_food_rda)
plot(cazyme_food_rda)
#a <- step(cazyme_food_rda)
cazyme_food_rda_s <- summary(cazyme_food_rda)
cazyme_food_rda_s
View(cazyme_food_rda_s)
cazyme_food_rda_s[["cont"]][["importance"]]
rda1 <- cazyme_food_rda_s[["cont"]][["importance"]]
View(rda1)
rda1 <- cazyme_food_rda_s[["cont"]][["importance"]][2,1]
rda2 <- cazyme_food_rda_s[["cont"]][["importance"]][2,2]
food_explanation <- (rda1+rda2)/(pc1+pc2)
#rda
cazyme_rda <- rda(cazyme_mean_clr~.,map_t)
rda1 <- cazyme_rda_s[["cont"]][["importance"]][2,1]
rda2 <- cazyme_rda_s[["cont"]][["importance"]][2,2]
basic_explanation <- (rda1+rda2)/(pc1+pc2)
cazyme.food <- cazyme_food_rda_s$biplot
View(cazyme_rda_s)
View(cazyme.food)
cazyme.subject <- cazyme_food_rda_s$sites
View(cazyme.subject)
cazyme.subject <- as.data.frame(cazyme_food_rda_s$sites)
View(cazyme.subject)
g <- ggplot(cazyme.subject,aes(x=RDA1,y=RDA2))+geom_point(aes(color=rownames(cazyme.subject)),size=2)+theme_classic()+
xlab(paste("RDA1",round(rda1*100,2),"%")) +ylab(paste("RDA2",round(rda2*100,2),"%")) +
scale_color_manual(values = UserNameColors) + labs(color='Subject')
g
cazyme.food <- as.data.frame(cazyme_food_rda_s$biplot)
View(cazyme.food)
}
for (i in 1:nrow(cazyme.food)){
g <- g  + annotate("text",x = cazyme.food[i,1]*7+0.03, y = cazyme.food[i,2]*7+0.03, label = rownames(cazyme.food)[i], color = "darkorange", size = 4)
g <- g  + annotate("segment", x = 0, y = 0, xend = cazyme.food[i,1]*7, yend = cazyme.food[i,2]*7, color = "darkorange", arrow = arrow(),size=1)
}
g
g <- ggplot(cazyme.subject,aes(x=RDA1,y=RDA2))+geom_point(aes(color=rownames(cazyme.subject)),size=2)+theme_classic()+
xlab(paste("RDA1",round(rda1*100,2),"%")) +ylab(paste("RDA2",round(rda2*100,2),"%")) +
scale_color_manual(values = UserNameColors) + labs(color='Subject')
for (i in 1:nrow(cazyme.food)){
g <- g  + annotate("text",x = cazyme.food[i,1]*7+0.1, y = cazyme.food[i,2]*7+0.1, label = rownames(cazyme.food)[i], color = "darkorange", size = 4)
g <- g  + annotate("segment", x = 0, y = 0, xend = cazyme.food[i,1]*7, yend = cazyme.food[i,2]*7, color = "darkorange", arrow = arrow(),size=1)
}
g
g <- ggplot(cazyme.subject,aes(x=RDA1,y=RDA2))+geom_point(aes(color=rownames(cazyme.subject)),size=2)+theme_classic()+
xlab(paste("RDA1",round(rda1*100,2),"%")) +ylab(paste("RDA2",round(rda2*100,2),"%")) +
scale_color_manual(values = UserNameColors) + labs(color='Subject')
for (i in 1:nrow(cazyme.food)){
g <- g  + annotate("text",x = cazyme.food[i,1]*7+0.4, y = cazyme.food[i,2]*7+0.4, label = rownames(cazyme.food)[i], color = "darkorange", size = 4)
g <- g  + annotate("segment", x = 0, y = 0, xend = cazyme.food[i,1]*7, yend = cazyme.food[i,2]*7, color = "darkorange", arrow = arrow(),size=1)
}
g
rda1 <- cazyme_food_rda_s[["cont"]][["importance"]][2,1]
rda2 <- cazyme_food_rda_s[["cont"]][["importance"]][2,2]
food_explanation <- (rda1+rda2)/(pc1+pc2)
ggsave("./result/rda.pdf",width = 5,height = 5)
ggsave("./result/rda.pdf",width = 8,height = 5)
ggsave("./result/rda.pdf",width = 7,height = 5)
g <- ggplot(cazyme_plots,aes(x=Axis.1,y=Axis.2))+geom_point(aes(color=rownames(cazyme_plots)),size=3)+theme_classic()+
xlab(paste("PC1",round(pc1*100,2),"%")) +ylab(paste("PC2",round(pc2*100,2),"%")) +
scale_color_manual(values = UserNameColors) + labs(color='Subject')
g
ggsave("./result/pcoa.pdf",width = 7,height = 5)
